full solution for different environments
